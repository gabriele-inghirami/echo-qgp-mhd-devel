## What the program does

Once compiled, *compute_initial_magnetic_field.c* computes the magnetic field generated by two colliding atomic nuclei with impact parameter b.

**Important:** The output file must be post processed before being used by ECHO-QGP! See the dedicated paragraph.

**Warning:** the results in Milne/Bjorken coordinates are correct only if a null initial velocity field is assumed!!!
With non-zero initial velocities, in the coordinate transformation laws enters also the electric field, which is not computed here.

## Dependencies on external libraries:

GNU [gsl](https://www.gnu.org/software/gsl/) (compiled and used with gsl>=2.4) 

## How to compile the program 

FLAGS="-O3 -march=native"
gcc -w $FLAGS compute_initial_magnetic_field.c -o compute_B.exe -lgsl -lgslcblas -lm 

The library path flag -L should be also used if a local version of the gsl has been installed. For example:
gcc -w $FLAGS compute_initial_magnetic_field.c -o compute_B.exe -L /usr/local/lib -lgsl -lgslcblas -lm
If the user has installed the gsl in the home directory or in other non standard location, then the environment variables should be set:
CPATH, LD_LIBRARY_PATH, LIBRARY_PATH and PATH
Please, note that not all of them might be necessary, but at least LD_LIBRARY_PATH should be properly set also when launching the program.
Please, refer to the abundant documentation on this topic (installation and use of library in non-default and/or non system-wide directories) available on the web.

## Syntax

./compute_B.exe b seq B_type name_of_outputfile z1 [z2] [z3]...
 or 
./compute_B.exe b range B_type name_of_outputfile zmin zmax Npoints
 or 
./compute_B.exe b point B_type x y z

The first argument b is the impact parameter expressed in fm.

The behaviour of the program and the structure of the rest of the argument list depend on the second command line option, which can be: seq, range or point. 

With “seq” the program computes the magnetic field at the various z (or eta,  if Milne coordinates are used) passed as arguments.
Example: ./compute_B.exe 5 seq 0 Boutfile.dat -2 2 0 2 2

With “range” the program computes the magnetic field generated by two ions colliding with an impact parameter of 5 fm for a number N of cells with central z coordinates between zmin and zmax, assuming that zmin and zmax are the borders of the first and last cells: if dz=(zmax-zmin)/Npoints, the first point is at zmin+dz/2. 
Example: ./compute_B.exe 5 range 0 Boutfile.dat -4 4 5

With “point” the program computes the magnetic field in the point of coordinates x, y and z.
Example: ./compute_B.exe 5 point 0 0 0 0

B_type determines the kind of initial magnetic field and it can be 0, 1 or 2:
- 0 means that both the classical and chiral magnetic fields are computed
- 1 that only the classical magnetic field is computed
- 2 that only the chiral magnetic field is computed.

The units of the computed magnetic field are: [GeV/fm^3]^1/2.

## Parameters in the code

By editing the first lines of the program and recompiling it, it possible to set the values of:
- the collision energy
- the properties of the ions
- the electrical and chiral conductivities
- the dimension and the resolution of the grid
- the impact parameter
- the time
- the system of coordinates (Milne/Minkowski)

## Structure of the output files

The first line of the output file summarizes the main parameters used to computed the B field, while the second line describes the content of the columns. A short feedback about the quality of the integration is also printed: OK00 means that the accuracy is within the default error tolerance, NO01 and NO02 means that the accuracy was decreased one or two times, NO03 means that the final result did not even meet the third required accuracy level. However, the worse situation is reported and if the error happened in the internal nested integration it might not have a big impact on the final results.

More in detail, the structure of the output file (apart from the header) is:
Column:  variable
1: x
2: y
3: z or eta  
4: H1x  (x classic magnetic field component of the first ion)
5: msg+failcode for H1x
6: H2x  (x classic magnetic field component of the second ion)
7: msg+failcode for H2x
8: H1Cx (x chiral magnetic field component of the first ion)
9: msg+failcode for H1Cx
10: H2Cx (x chiral magnetic field component of the second ion)
11: msg+failcode for H2Cx
12: H1y  (y classic magnetic field component of the first ion)
13: msg+failcode for H1y
14: H2y  (y classic magnetic field component of the second ion)
15: msg+failcode for H2y
16: H1Cy (y chiral magnetic field component of the first ion)
17: msg+failcode for H1Cy
18: H2Cy (y chiral magnetic field component of the second ion)
19: msg+failcode for H2Cy
20: H1Cz (z chiral magnetic field component of the first ion)
21: msg+failcode for H1Cz
22: H2Cz (z chiral magnetic field component of the second ion)
23: msg+failcode for H2Cz

## Post processing of the output file

Two python3 and two gnuplot scripts are provided for postprocessing:
- format_raw_B_computation.py: it prepares the results for ECHO-QGP and for an easier plotting with gnuplot. The file to be plotted with gnuplot has a 4gp suffix and the results can be scaled by a conv_factor factor (by default, to convert B in units of neutral pion mass squared).
- python3/process_data_to_plot_field_lines.py: it prepares the results to plot the vector fields. The grid data and the sampling frequency of the points for which to plot the arrows must be properly set in advance. No unit   conversion is performed.
- plot2d_B_slices.gp: it makes contour plots within a certain z-index range. The name of the data file must be adjusted and the parameter st must be set to the correct z-spacing of the grid.
- plot_initial_B_field_lines_as_arrows.gp: it makes vector field plots. By default, it converts B from GeV^1/2/fm^3/2 to pion mass squared units.
